# rust_web_sample

適当に作った Rust の Web バックエンドの例

## 必要なものをインストール

### `cargo watch`をインストール

```bash
cargo install cargo-watch
```

### `sea-orm-cli`をインストール

```bash
cargo install sea-orm-cli
```

## DB 初期化

### migrate init を実行

これでマイグレーションクレートができる
※このプロジェクトでは作成済みのため不要

```bash
sea-orm-cli migrate init
```

## migration について

マイグレーションを適用する前に`.env`に合わせて DB を作成しておくこと

### 新規作成

```bash
sea-orm-cli migrate generate {マイグレーション名}
```

### マイグレーション適用

```bash
sea-orm-cli migrate up
```

## アーキテクチャについて

オニオンアーキテクチャ

### インタフェース層

`crates/interface`

ルーティングとか UI とかを配置

アプリケーション層以下に依存

### インフラ層

`crates/infra`

ファイルアクセスや DB アクセスなどを配置

アプリケーション層以下に依存

ドメインモデルへの直接の依存も OK(ORM の Entity をドメインモデルに変換する必要があるため)

リポジトリの実装はここに

### アプリケーションサービス層

`crates/app-service`

インターフェースとドメインとインフラのつなぎをする中間層
リポジトリの IF 定義(トレイト)はここに置く

データ変換とかはここでやる(入力をドメインモデルに変換など)

### ドメインサービス層

`crates/domain-service`

ドメインモデル層にのみ依存する
リポジトリの IF 定義(トレイト)はここにも置く

複数のドメインモデルにまたがるビジネスロジックや、ドメインモデルに依存しないビジネスロジックを書く。

### ドメインモデル層

`crates/domain-model`

ほかの層に依存しない

ドメインモデル毎に、自身の定義と、自身の振る舞いの定義を書く

## テストコードについて

### 不要なテストコード

ドメインサービスとアプリケーションサービスの層にある各 new 関数のテストは記載不要
※失敗するケースがなく、引数のモックの用意の手間が大きいため

トレイトの実装メソッドはドキュメントテスト不要
ただし通常のユニットテストは必要
